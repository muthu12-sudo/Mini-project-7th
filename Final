import torch
from torchvision import models, transforms
from PIL import Image
import matplotlib.pyplot as plt

# Function to load and preprocess the image
def process_image(image_path):
    # Define the transformation for the image
    transform = transforms.Compose([
        transforms.Resize((224, 224)),  # Resize the image to match model input
        transforms.ToTensor(),          # Convert image to tensor
        transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])  # Normalize
    ])

    # Open the image
    img = Image.open(image_path)

    # Apply transformations to the image
    img_tensor = transform(img).unsqueeze(0)  # Add batch dimension (1, C, H, W)
    return img_tensor

# Load the pretrained ResNet50 model
def load_model():
    model = models.resnet50(pretrained=True)
    model.eval()  # Set the model to evaluation mode
    return model

# Perform inference on the image using the loaded model
def predict(model, img_tensor):
    with torch.no_grad():  # No gradient calculation needed during inference
        outputs = model(img_tensor)

    # Get the predicted class index
    _, predicted_class = torch.max(outputs, 1)
    return predicted_class.item()

# Display the image and the predicted class
def display_result(image_path, predicted_class_idx):
    # Load and display the image
    img = Image.open(image_path)
    plt.imshow(img)
    plt.title(f'Predicted Class Index: {predicted_class_idx}')
    plt.show()

# Main function to load model, process image, and make predictions
def main(image_path):
    # Load the model
    model = load_model()

    # Process the image
    img_tensor = process_image(image_path)

    # Perform prediction
    predicted_class_idx = predict(model, img_tensor)

    # Display the result
    display_result(image_path, predicted_class_idx)

# Provide the image path
image_path = 'path/to/your/image.jpg'  # Replace with the path to your image

# Run the main function
main(image_path)
